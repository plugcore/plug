<div class="container">
	<mat-card>
		<mat-card-header>
			<mat-card-title>{{isUpdate ? 'Update Api' : 'Create Api Proxy'}}</mat-card-title>
		</mat-card-header>
		<mat-card-content>
			<form [formGroup]="apiForm" (ngSubmit)="onSubmit()">

				<div class="form-section">
					<h4>Method</h4>
					<mat-form-field>
						<mat-select formControlName="method">
							<mat-option value="GET">GET</mat-option>
							<mat-option value="POST">POST</mat-option>
							<mat-option value="PATCH">PATCH</mat-option>
							<mat-option value="PUT">PUT</mat-option>
							<mat-option value="DELETE">DELETE</mat-option>
						</mat-select>
					</mat-form-field>
				</div>

				<div class="form-section full-width">
					<h4>URI</h4>
					<mat-form-field>
						<input matInput formControlName="uri">
					</mat-form-field>
				</div>

				<div class="form-section">
					<h4>Tags</h4>
					<mat-form-field class="example-chip-list">
						<mat-chip-list #chipList aria-label="Tags selection">
							<mat-chip *ngFor="let tag of apiForm.get('tags').value" [selectable]="selectable"
								[removable]="removable" (removed)="remove(tag)">
								{{tag}}
								<mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
							</mat-chip>
							<input placeholder="Enter tags ..." [matChipInputFor]="chipList"
								[matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
								(matChipInputTokenEnd)="add($event)">
						</mat-chip-list>
					</mat-form-field>
				</div>

				<div class="form-section full-width">
					<h4>Description</h4>
					<mat-form-field>
						<textarea matInput formControlName="description"></textarea>
					</mat-form-field>
				</div>

				<ng-container *ngIf="isApiProxy">

					<div class="form-section full-width">
						<h4>Target url</h4>
						<mat-form-field>
							<input matInput formControlName="targetUrl">
						</mat-form-field>
					</div>

					<div class="form-section">
						<h4>Connection retries</h4>
						<mat-form-field>
							<input matInput type="number" formControlName="retries">
						</mat-form-field>
					</div>

					<div class="form-section">
						<h4>Connection timeout in seconds</h4>
						<mat-form-field>
							<input matInput type="number" formControlName="timeout">
						</mat-form-field>
					</div>

				</ng-container>

				<ng-container *ngIf="!isApiProxy">

					<div class="form-section">
						<h4>Javascript class</h4>
						<span class="block-desc">{{ currentData.jsClass }}</span>
					</div>

					<div class="form-section">
						<h4>Javascript method</h4>
						<span class="block-desc">{{ currentData.jsMethod }}</span>
					</div>

				</ng-container>

				<div class="documentation-wrapper" [formGroup]="apiForm.get('documentation')">
					<h4>Documentation</h4>
					<div class="documentation-element">
						<h4>Request</h4>
						<div class="element-box">
							<div class="edited-version">
								<div class="span-el-title">Edit</div>
								<mat-form-field class="example-full-width">
									<textarea matInput formControlName="request"></textarea>
								</mat-form-field>
							</div>
							<div class="current-version">
								<div class="span-el-title">Current version</div>
								<plug-json-navigation
									*ngIf="currentData && currentData.documentation && currentData.documentation.request"
									[data]="currentData.documentation.request"></plug-json-navigation>
								<span *ngIf="!currentData || !currentData.documentation || !currentData.documentation.request">
									[EMPTY]
								</span>
							</div>
						</div>
					</div>

					<div class="documentation-element">
						<h4>Response</h4>
						<div class="element-box">
							<div class="edited-version">
								<div class="span-el-title">Edit</div>
								<mat-form-field class="example-full-width">
									<textarea matInput formControlName="response"></textarea>
								</mat-form-field>
							</div>
							<div class="current-version">
								<div class="span-el-title">Current version</div>
								<plug-json-navigation
									*ngIf="currentData && currentData.documentation && currentData.documentation.response"
									[data]="currentData.documentation.response"></plug-json-navigation>
								<span *ngIf="!currentData || !currentData.documentation || !currentData.documentation.response">
									[EMPTY]
								</span>
							</div>
						</div>
					</div>

					<div class="documentation-element">
						<h4>Parameters</h4>
						<div class="element-box">
							<div class="edited-version">
								<div class="span-el-title">Edit</div>
								<mat-form-field class="example-full-width">
									<textarea matInput formControlName="parameters"></textarea>
								</mat-form-field>
							</div>
							<div class="current-version">
								<div class="span-el-title">Current version</div>
								<plug-json-navigation
									*ngIf="currentData && currentData.documentation && currentData.documentation.parameters"
									[data]="currentData.documentation.parameters"></plug-json-navigation>
								<span *ngIf="!currentData || !currentData.documentation || !currentData.documentation.parameters">
									[EMPTY]
								</span>
							</div>
						</div>
					</div>

					<div class="documentation-element">
						<h4>Url Parameters</h4>
						<div class="element-box">
							<div class="edited-version">
								<div class="span-el-title">Edit</div>
								<mat-form-field class="example-full-width">
									<textarea matInput formControlName="urlparameters" ></textarea>
								</mat-form-field>
							</div>
							<div class="current-version">
								<div class="span-el-title">Current version</div>
								<plug-json-navigation
									*ngIf="currentData && currentData.documentation && currentData.documentation.urlparameters"
									[data]="currentData.documentation.urlparameters"></plug-json-navigation>
								<span *ngIf="!currentData || !currentData.documentation || !currentData.documentation.urlparameters">
									[EMPTY]
								</span>
							</div>
						</div>
					</div>

					<div class="documentation-element">
						<h4>Headers</h4>
						<div class="element-box">
							<div class="edited-version">
								<div class="span-el-title">Edit</div>
								<mat-form-field class="example-full-width">
									<textarea matInput formControlName="headers"></textarea>
								</mat-form-field>
							</div>
							<div class="current-version">
								<div class="span-el-title">Current version</div>
								<plug-json-navigation
									*ngIf="currentData && currentData.documentation && currentData.documentation.headers"
									[data]="currentData.documentation.headers"></plug-json-navigation>
								<span *ngIf="!currentData || !currentData.documentation || !currentData.documentation.headers">
									[EMPTY]
								</span>
							</div>
						</div>
					</div>

				</div>
				<div class="buttons-wrapper" *ngIf="isApiProxy">
					<button mat-raised-button type="submit" color="primary"
						[disabled]="!apiForm.valid">{{isUpdate ? 'Update' : 'Create'}}</button>
				</div>
			</form>
		</mat-card-content>
	</mat-card>
</div>
